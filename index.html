<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PlaySkratch v1.3.2</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    :root {
      --primary: #D72638;
      --bg: #fdfdfd;
      --card: #ffffff;
      --input: #f1f1f1;
      --text: #111;
    }
    body {
      font-family: Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 1rem;
    }
    h1 {
      color: var(--primary);
      text-align: center;
      margin-bottom: 1rem;
    }
    .section {
      background: var(--card);
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: 10px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    label {
      font-weight: bold;
      display: block;
      margin: 1rem 0 0.3rem;
    }
    input, select, textarea {
      width: 100%;
      padding: 1rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      background: var(--input);
      color: var(--text);
    }
    input:focus, select:focus, textarea:focus {
      border-color: var(--primary);
      outline: none;
    }
    button {
      display: block;
      width: 100%;
      padding: 1rem;
      font-size: 1rem;
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 6px;
      margin-top: 1rem;
      cursor: pointer;
    }
    details summary {
      cursor: pointer;
      font-weight: bold;
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
    }
    .hole-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    .sticky-save {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: var(--card);
      padding: 1rem;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
      z-index: 999;
    }
    textarea.readonly {
      background: var(--input);
      color: var(--text);
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <h1>PlaySkratch v1.3.2</h1>

  <div class="section">
    <button onclick="exportCoachPDF()">Export PDF for Coach</button>
  </div>

  <div class="section">
    <details open>
      <summary>Practice Log</summary>
      <label>Date</label>
      <input type="date" id="practiceDate" />
      <label>Type</label>
      <select id="practiceType">
        <option>Full Swing</option>
        <option>Short Game</option>
        <option>Putting</option>
        <option>Wedge Matrix</option>
      </select>
      <label>Clubs Used</label>
      <input type="text" id="practiceClubs" placeholder="e.g., 7i, 56°, Driver" />
      <label>Notes</label>
      <textarea id="practiceNotes" rows="3"></textarea>
      <button onclick="savePractice()">Log Practice</button>
      <div id="practiceHistory" style="margin-top: 1rem;"></div>
    </details>
  </div>

  <div class="section">
    <details>
      <summary>Round Setup</summary>
      <label>Date</label>
      <input type="date" id="roundDate" />
      <label>Course</label>
      <input type="text" id="roundCourse" placeholder="e.g., Cheadle Golf Club" />
      <label>Tee</label>
      <select id="roundTee">
        <option>Yellow</option>
        <option>White</option>
      </select>
      <label>Ball</label>
      <input type="text" id="roundBall" />
      <label>Bag</label>
      <input type="text" id="roundBag" />
      <label>Weather / Notes</label>
      <textarea id="roundWeather" rows="3"></textarea>
    </details>
  </div>

  <div class="section">
    <details>
      <summary>Hole-by-Hole</summary>
      <div id="holesContainer"></div>
    </details>
  </div>

  <div class="section">
  <details>
    <summary>Round History</summary>
    <div id="roundHistory" style="margin-top: 1rem;"></div>
  </details>
</div>


  <div class="sticky-save">
    <button onclick="logRound()">Save Round</button>
  </div>

  <script>
    function savePractice() {
      const data = {
        date: document.getElementById('practiceDate').value,
        type: document.getElementById('practiceType').value,
        clubs: document.getElementById('practiceClubs').value,
        notes: document.getElementById('practiceNotes').value
      };
      if (!data.date || !data.type || !data.clubs) {
        alert('Please fill in all required fields.');
        return;
      }
      const sessions = JSON.parse(localStorage.getItem('practice') || '[]');
      sessions.push(data);
      localStorage.setItem('practice', JSON.stringify(sessions));
      alert('Practice logged!');
      showPracticeSessions();
    }

    function showPracticeSessions() {
      const container = document.getElementById('practiceHistory');
      container.innerHTML = '';
      const sessions = JSON.parse(localStorage.getItem('practice') || '[]').reverse();
      if (sessions.length === 0) {
        container.innerHTML = '<p>No sessions yet.</p>';
        return;
      }
      sessions.forEach(s => {
        const div = document.createElement('div');
        div.innerHTML = `<strong>${s.date}</strong> – ${s.type}<br>Clubs: ${s.clubs}<br>Notes: ${s.notes || '-'}<hr>`;
        container.appendChild(div);
      });
    }

    function logRound() {
      const round = {
        date: document.getElementById('roundDate').value,
        course: document.getElementById('roundCourse').value,
        tee: document.getElementById('roundTee').value,
        ball: document.getElementById('roundBall').value,
        bag: document.getElementById('roundBag').value,
        weather: document.getElementById('roundWeather').value,
        holes: []
      };
      for (let i = 1; i <= 18; i++) {
        const h = {
          score: document.getElementById(`score${i}`).value,
          fir: document.getElementById(`fir${i}`).value,
          gir: document.getElementById(`gir${i}`).value,
          putts: document.getElementById(`putts${i}`).value
        };
        round.holes.push(h);
      }
      const rounds = JSON.parse(localStorage.getItem('rounds') || '[]');
      rounds.push(round);
      localStorage.setItem('rounds', JSON.stringify(rounds));
      alert('Round saved!');
    }

    function buildHoleInputs() {
  const container = document.getElementById('holesContainer');
  for (let i = 1; i <= 18; i++) {
    const div = document.createElement('div');
    div.className = 'hole-row';
    div.innerHTML = `
      <label>Hole ${i}</label>
      <input type="number" id="score${i}" placeholder="Score" min="1" max="12" />
      <select id="fir${i}">
        <option>FIR</option><option>✔</option><option>Left</option><option>Right</option><option>N/A</option>
      </select>
      <select id="gir${i}">
        <option>GIR</option><option>✔</option><option>Short</option><option>Long</option><option>Left</option><option>Right</option>
      </select>
      <input type="number" id="putts${i}" placeholder="Putts" min="0" max="5" />
    `;
    container.appendChild(div);
  }
}

function exportCoachPDF() {
  const rounds = JSON.parse(localStorage.getItem('rounds') || '[]');
  const practice = JSON.parse(localStorage.getItem('practice') || '[]');
  if (rounds.length === 0) return alert('No rounds logged.');

  const doc = new jspdf.jsPDF();
  const latest = rounds[rounds.length - 1];

  doc.setFontSize(14);
  doc.text(`PlaySkratch Coach Report`, 10, 10);
  doc.setFontSize(10);
  doc.text(`Date: ${latest.date}`, 10, 20);
  doc.text(`Course: ${latest.course}`, 10, 26);
  doc.text(`Tee: ${latest.tee}`, 10, 32);
  doc.text(`Ball: ${latest.ball}`, 10, 38);
  doc.text(`Bag: ${latest.bag}`, 10, 44);
  doc.text(`Weather: ${latest.weather}`, 10, 50);

  let y = 60;
  doc.text('Hole  Score  FIR  GIR  Putts', 10, y);
  y += 6;

  let totalScore = 0;
  let frontScore = 0;
  let backScore = 0;

  latest.holes.forEach((h, i) => {
    const score = parseInt(h.score) || 0;
    totalScore += score;
    if (i < 9) frontScore += score;
    else backScore += score;

    const line = `${i + 1}`.padEnd(5) + `${h.score}`.padEnd(7) + `${h.fir}`.padEnd(6) + `${h.gir}`.padEnd(6) + `${h.putts}`;
    doc.text(line, 10, y);
    y += 6;
    if (y > 270) { doc.addPage(); y = 10; }
  });

  y += 4;
  doc.setFontSize(11);
  doc.text(`Front 9 Total: ${frontScore}`, 10, y);
  y += 6;
  doc.text(`Back 9 Total: ${backScore}`, 10, y);
  y += 6;
  doc.text(`Overall Total Score: ${totalScore}`, 10, y);
  y += 10;

  doc.setFontSize(12);
  doc.text('Last 5 Practice Sessions', 10, y);
  y += 6;

  const recentPractice = practice.reverse().slice(0, 5);
  doc.setFontSize(10);
  if (recentPractice.length === 0) {
    doc.text('No practice sessions logged.', 10, y);
  } else {
    recentPractice.forEach((p) => {
      const text = `${p.date} – ${p.type} | Clubs: ${p.clubs} | Notes: ${p.notes || '-'}`;
      const lines = doc.splitTextToSize(text, 180);
      doc.text(lines, 10, y);
      y += lines.length * 6;
      if (y > 270) { doc.addPage(); y = 10; }
    });
  }

  y += 10;
  doc.setFontSize(12);
  doc.text('Last 5 Rounds', 10, y);
  y += 6;

  const recentRounds = rounds.slice(-5).reverse();
  doc.setFontSize(10);
  if (recentRounds.length === 0) {
    doc.text('No rounds available.', 10, y);
  } else {
    recentRounds.forEach((r) => {
      let total = 0, front = 0, back = 0;
      r.holes.forEach((h, i) => {
        const s = parseInt(h.score) || 0;
        total += s;
        if (i < 9) front += s;
        else back += s;
      });
      const summary = `${r.date} – ${r.course || 'Unknown Course'} | Front 9: ${front} | Back 9: ${back} | Total: ${total}`;
      const lines = doc.splitTextToSize(summary, 180);
      doc.text(lines, 10, y);
      y += lines.length * 6;
      if (y > 270) { doc.addPage(); y = 10; }
    });
  }

  doc.save(`PlaySkratch_Coach_Report_${latest.date}.pdf`);
    }

    function showRoundHistory() {
  const container = document.getElementById('roundHistory');
  container.innerHTML = '';
  const rounds = JSON.parse(localStorage.getItem('rounds') || '[]').reverse();
  if (rounds.length === 0) {
    container.innerHTML = '<p>No rounds logged yet.</p>';
    return;
  }
  rounds.forEach(r => {
    let total = 0;
    let front = 0;
    let back = 0;
    r.holes.forEach((h, i) => {
      const score = parseInt(h.score) || 0;
      total += score;
      if (i < 9) front += score;
      else back += score;
    });
    const div = document.createElement('div');
    div.innerHTML = `<strong>${r.date}</strong> — ${r.course || 'Unknown Course'}<br>
      Front 9: ${front} | Back 9: ${back} | Total: ${total}<hr>`;
    container.appendChild(div);
  });
}

window.onload = function() {
      showPracticeSessions();
      buildHoleInputs();
      showRoundHistory();
    }
  </script>
</body>
</html>

